<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div class="row">
    <div class="col-12">
        <div class="cards">
            <div class="card border-0">
                <h2>My Profile </h2>
                <form th:action="@{/saveProfile}" th:object="${profileDetails}" method="post">
                    <input type="hidden" th:field="*{id}">
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">User ID</label>
                                <input class="form-control" type="text" th:field="*{user_name}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">First Name</label>
                                <input class="form-control" type="text" th:field="*{first_name}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Last Name</label>
                                <input class="form-control" type="text" th:field="*{last_name}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Mobile No.</label>
                                <input class="form-control" type="text" th:field="*{mobile_no}" readonly>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Email ID</label>
                                <input class="form-control" type="text" th:field="*{email}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Designation  </label>
                                <input class="form-control" type="text" th:field="*{designation}"  onblur="validateDesignation(designation)" id="designation" title="Please enter alphabets only">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Teaching Exp. (In Years and Months)</label>
                                <input class="form-control" type="text" th:field="*{teaching_experience}" pattern="^[a-zA-Z]+$" title="Please enter alphabets only" required >
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Industry Exp. (In Years and Months)</label>
                                <input class="form-control" type="text" th:field="*{industry_experience}">
                            </div>
                        </div>
                        <div class="col-md-12"><h2>Bank Details</h2></div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Account Number</label>
                                <input class="form-control" type="text" th:field="*{account_no}" pattern="^[a-zA-Z0-9]{5,20}$" minlength="5" maxlength="20"
                                       title="Please enter between 5 and 20 alphanumeric characters" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">IFSC Code </label>
                                <input class="form-control" type="text" th:field="*{ifsc_code}" onblur="fetchBankDetails()">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Bank Name</label>
                                <input class="form-control" readonly  type="text" th:field="*{bank_name}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Branch Details </label>
                                <input class="form-control"  readonly type="text" th:field="*{branch_details}">
                            </div>
                        </div>



                        <div class="col-md-12">
                            <div class="mb-3">
                                <button class="btn btn-primary">Save &amp; Update</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
function fetchBankDetails() {
var ifscCode = document.getElementById("ifsc_code").value.trim(); // Trim spaces

if (ifscCode.length !== 11) {
alert("IFSC Code must be exactly 11 characters.");
return;
}

fetch("https://online.ctestservices.com/gtuqp/api/bank/getDetails/" + ifscCode)
.then(response => {
if (!response.ok) {
throw new Error("Invalid IFSC Code or API error");
}
return response.json();
})
.then(data => {
if (data && data.BANK && data.BRANCH) {
document.getElementById("bank_name").value = data.BANK;
document.getElementById("branch_details").value = Object.entries(data)
    .map(([key, value]) => `${key}: ${value}`)
    .join(", ");
} else {
alert("Invalid IFSC Code or no data found.");
}
})
.catch(error => {
console.error("Error:", error);
alert("Error fetching bank details. Please check the IFSC code.");
});
}
function validateDesignation(designation) {
    const input = document.getElementById('designation');
    const regex = /^[a-zA-Z]+$/;
    if (!regex.test(input.value)) {
        alert("Please enter alphabets .");
        input.value = '';
        return false;  // Prevent form submission
    }
    return true;
}
</script>